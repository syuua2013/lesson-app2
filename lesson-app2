<!DOCTYPE html>

<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

  <!-- PWAË®≠ÂÆö -->

  <meta name="theme-color" content="#9333ea">
  <meta name="description" content="Èü≥Ê•Ω„É¨„ÉÉ„Çπ„É≥„ÅÆË®òÈå≤„ÇíÁÆ°ÁêÜ„Åô„Çã„Ç¢„Éó„É™">

  <!-- iOSÂ∞ÇÁî®Ë®≠ÂÆö -->

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="„É¨„ÉÉ„Çπ„É≥Ë®òÈå≤">

  <!-- „Ç¢„Ç§„Ç≥„É≥Ë®≠ÂÆö -->

  <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' fill='%239333ea' rx='40'/%3E%3Cpath d='M54 126V45l72-12.6v77.4M54 126c0 9.9-8.1 18-18 18s-18-8.1-18-18 8.1-18 18-18 18 8.1 18 18zm72-12.6c0 9.9-8.1 18-18 18s-18-8.1-18-18 8.1-18 18-18 18 8.1 18 18' fill='white' stroke='white' stroke-width='3.6'/%3E%3C/svg%3E">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%239333ea' rx='20'/%3E%3Cpath d='M30 70V25l40-7v43M30 70c0 5.5-4.5 10-10 10s-10-4.5-10-10 4.5-10 10-10 10 4.5 10 10zm40-7c0 5.5-4.5 10-10 10s-10-4.5-10-10 4.5-10 10-10 10 4.5 10 10' fill='white' stroke='white' stroke-width='2'/%3E%3C/svg%3E">

  <title>Èü≥Ê•Ω„É¨„ÉÉ„Çπ„É≥Ë®òÈå≤ÁÆ°ÁêÜ</title>

  <!-- manifest.jsonÔºà„Ç§„É≥„É©„Ç§„É≥Ôºâ -->

  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi6Z+z5qW95Ys+44OD44K544Oz6KiY6Yyy566h55CGIiwic2hvcnRfbmFtZSI6IuODrOODg+OCueODsyIsInN0YXJ0X3VybCI6Ii4vIiwiaWQiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYiLCJ0aGVtZV9jb2xvciI6IiM5MzMzZWEiLCJvcmllbnRhdGlvbiI6InBvcnRyYWl0Iiwic2NvcGUiOiIuLyIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDE5MiAxOTInJTNFJTNDcmVjdCB3aWR0aD0nMTkyJyBoZWlnaHQ9JzE5MicgZmlsbD0nJTkzMzNlYScgcng9JzQwJy8lM0UlM0NwYXRoIGQ9J001NyAxMzRWNDhsNzYtMTN2ODJNNTcgMTM0YzAgMTAtOSAxOS0xOSAxOXMtMTktOS0xOS0xOSA5LTE5IDE5LTE5IDE5IDkgMTkgMTl6bTc2LTEzYzAgMTAtOSAxOS0xOSAxOXMtMTktOS0xOS0xOSA5LTE5IDE5LTE5IDE5IDkgMTkgMTknIGZpbGw9J3doaXRlJyBzdHJva2U9J3doaXRlJyBzdHJva2Utd2lkdGg9JzMuOCcvJTNFJTNDL3N2ZyUzRSIsInNpemVzIjoiMTkyeDE5MiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIiwicHVycG9zZSI6ImFueSJ9LHsic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCA1MTIgNTEyJyUzRSUzQ3JlY3Qgd2lkdGg9JzUxMicgaGVpZ2h0PSc1MTInIGZpbGw9JyU5MzMzZWEnIHJ4PScxMDAnLyUzRSUzQ3BhdGggZD0nTTE1MyAzNThWMTI4bDIwNC0zNXYyMTlNMTUzIDM1OGMwIDI3LTIyIDQ5LTQ5IDQ5cy00OS0yMi00OS00OSAyMi00OSA0OS00OSA0OSAyMiA0OSA0OXptMjA0LTM1YzAgMjctMjIgNDktNDkgNDlzLTQ5LTIyLTQ5LTQ5IDIyLTQ5IDQ5LTQ5IDQ5IDIyIDQ5IDQ5JyBmaWxsPSd3aGl0ZScgc3Ryb2tlPSd3aGl0ZScgc3Ryb2tlLXdpZHRoPScxMCcvJTNFJTNDL3N2ZyUzRSIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIiwicHVycG9zZSI6ImFueSJ9XX0=">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    * {
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      margin: 0;
      padding: 0;
      overscroll-behavior-y: contain;
      -webkit-overflow-scrolling: touch;
    }
    
    /* iOS safe areaÂØæÂøú */
    .safe-top {
      padding-top: env(safe-area-inset-top);
    }
    
    .safe-bottom {
      padding-bottom: env(safe-area-inset-bottom);
    }
    
    /* „Ç§„É≥„Çπ„Éà„Éº„É´„Éó„É≠„É≥„Éó„Éà */
    .install-banner {
      position: fixed;
      top: env(safe-area-inset-top, 0);
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%);
      color: white;
      padding: 16px;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateY(-100%);
      transition: transform 0.3s ease-out;
    }
    
    .install-banner.show {
      transform: translateY(0);
    }
    
    /* „Çπ„É†„Éº„Ç∫„Çπ„ÇØ„É≠„Éº„É´ */
    .smooth-scroll {
      -webkit-overflow-scrolling: touch;
    }
  </style>

</head>
<body>
  <div id="root"></div>

  <!-- iOSÁî®„Ç§„É≥„Çπ„Éà„Éº„É´Ê°àÂÜÖ„Éê„Éä„Éº -->

  <div id="iosInstallBanner" class="install-banner">
    <div style="display: flex; align-items: center; justify-content: space-between;">
      <div style="flex: 1;">
        <div style="font-weight: 600; margin-bottom: 4px; font-size: 15px;">üì± „Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†</div>
        <div style="font-size: 13px; opacity: 0.95;">
          ‰∏ã„ÅÆ<strong>ÂÖ±Êúâ„Éú„Çø„É≥</strong>„Çí„Çø„ÉÉ„Éó ‚Üí „Äå„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Äç„ÇíÈÅ∏Êäû
        </div>
      </div>
      <button id="closeBanner" style="background: rgba(255,255,255,0.2); color: white; padding: 8px 12px; border-radius: 8px; border: none; font-size: 14px; margin-left: 12px;">
        Èñâ„Åò„Çã
      </button>
    </div>
  </div>

  <script>
    // iOSÂà§ÂÆö
    const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    const isInStandaloneMode = ('standalone' in window.navigator) && (window.navigator.standalone);
    
    // Service WorkerÁôªÈå≤ÔºàHTTPS„Åæ„Åü„ÅØlocalhost„Åß„ÅÆ„ÅøÂãï‰ΩúÔºâ
    if ('serviceWorker' in navigator && (location.protocol === 'https:' || location.hostname === 'localhost')) {
      window.addEventListener('load', () => {
        const swCode = `
          const CACHE_NAME = 'music-lesson-v2';
          const urlsToCache = ['./', './index.html'];
          
          self.addEventListener('install', (event) => {
            event.waitUntil(
              caches.open(CACHE_NAME).then((cache) => {
                return cache.addAll(urlsToCache.map(url => new Request(url, {cache: 'reload'})));
              })
            );
            self.skipWaiting();
          });
          
          self.addEventListener('activate', (event) => {
            event.waitUntil(
              caches.keys().then((cacheNames) => {
                return Promise.all(
                  cacheNames.filter((name) => name !== CACHE_NAME)
                    .map((name) => caches.delete(name))
                );
              })
            );
            return self.clients.claim();
          });
          
          self.addEventListener('fetch', (event) => {
            event.respondWith(
              caches.match(event.request).then((response) => {
                return response || fetch(event.request).then((fetchResponse) => {
                  return caches.open(CACHE_NAME).then((cache) => {
                    cache.put(event.request, fetchResponse.clone());
                    return fetchResponse;
                  });
                });
              }).catch(() => {
                return caches.match('./');
              })
            );
          });
        `;
        
        const blob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        
        navigator.serviceWorker.register(swUrl)
          .then((reg) => {
            console.log('‚úÖ Service WorkerÁôªÈå≤ÊàêÂäü');
            // Êõ¥Êñ∞„ÉÅ„Çß„ÉÉ„ÇØ
            reg.update();
          })
          .catch((err) => console.log('‚ö†Ô∏è Service WorkerÁôªÈå≤Â§±Êïó:', err));
      });
    }
    
    // iOS„Ç§„É≥„Çπ„Éà„Éº„É´„Éê„Éä„ÉºË°®Á§∫
    const banner = document.getElementById('iosInstallBanner');
    const closeBannerBtn = document.getElementById('closeBanner');
    
    if (isIOS && !isInStandaloneMode) {
      const hasSeenBanner = localStorage.getItem('ios-install-banner-seen');
      if (!hasSeenBanner) {
        setTimeout(() => {
          banner.classList.add('show');
        }, 2000);
      }
    }
    
    closeBannerBtn?.addEventListener('click', () => {
      banner.classList.remove('show');
      localStorage.setItem('ios-install-banner-seen', 'true');
    });
    
    // PWAËµ∑ÂãïÊ§úÂá∫
    if (isInStandaloneMode || window.matchMedia('(display-mode: standalone)').matches) {
      console.log('üéâ PWA„É¢„Éº„Éâ„ÅßÂÆüË°å‰∏≠');
      document.body.style.paddingTop = 'env(safe-area-inset-top)';
    }
  </script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Icons
    const Music = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M9 18V5l12-2v13M9 18c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zm12-2c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3z"/>
      </svg>
    );

    const Plus = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    );

    const Search = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
      </svg>
    );

    const Calendar = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/>
        <line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
    );

    const User = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
      </svg>
    );

    const Mic = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
        <path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v4M8 23h8"/>
      </svg>
    );

    const FileText = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/>
        <line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>
      </svg>
    );

    const Image = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/>
      </svg>
    );

    const Trash2 = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        <line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>
      </svg>
    );

    const Edit2 = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
      </svg>
    );

    const X = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    );

    const Save = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
        <polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>
      </svg>
    );

    const MusicLessonTracker = () => {
      const [lessons, setLessons] = useState([]);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingLesson, setEditingLesson] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [filterTeacher, setFilterTeacher] = useState('');
      const [isLoading, setIsLoading] = useState(true);

      const [formData, setFormData] = useState({
        date: '',
        teacher: '',
        audioFile: null,
        audioFileName: '',
        summary: '',
        noteImage: null,
        noteImageName: '',
        diagramImage: null,
        diagramImageName: ''
      });

      const STORAGE_KEY = 'music-lessons-data';

      useEffect(() => {
        loadLessons();
      }, []);

      const loadLessons = () => {
        setIsLoading(true);
        try {
          const data = localStorage.getItem(STORAGE_KEY);
          if (data) {
            setLessons(JSON.parse(data));
          }
        } catch (error) {
          console.log('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
        } finally {
          setIsLoading(false);
        }
      };

      const saveLessons = (updatedLessons) => {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(updatedLessons));
        } catch (error) {
          console.error('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
          alert('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
        }
      };

      const handleFileChange = (e, field) => {
        const file = e.target.files[0];
        if (file) {
          // „Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫„ÉÅ„Çß„ÉÉ„ÇØÔºà50MB„Åæ„ÅßÔºâ
          const maxSize = 50 * 1024 * 1024; // 50MB
          if (file.size > maxSize) {
            alert('„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫„ÅåÂ§ß„Åç„Åô„Åé„Åæ„Åô„ÄÇ50MB‰ª•‰∏ã„ÅÆ„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            e.target.value = ''; // ÂÖ•Âäõ„Çí„ÇØ„É™„Ç¢
            return;
          }

          const reader = new FileReader();
          reader.onloadend = () => {
            setFormData(prev => ({
              ...prev,
              [field]: reader.result,
              [`${field}Name`]: file.name
            }));
          };
          reader.onerror = () => {
            alert('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
            e.target.value = '';
          };
          reader.readAsDataURL(file);
        }
      };

      const handleSubmit = () => {
        if (!formData.date || !formData.teacher) {
          alert('Êó•‰ªò„Å®ÂÖàÁîü„ÅÆÂêçÂâç„ÅØÂøÖÈ†à„Åß„Åô');
          return;
        }

        const newLesson = {
          id: editingLesson ? editingLesson.id : Date.now(),
          ...formData,
          createdAt: editingLesson ? editingLesson.createdAt : new Date().toISOString()
        };

        let updatedLessons;
        if (editingLesson) {
          updatedLessons = lessons.map(l => l.id === editingLesson.id ? newLesson : l);
        } else {
          updatedLessons = [newLesson, ...lessons];
        }

        setLessons(updatedLessons);
        saveLessons(updatedLessons);

        resetForm();
        setIsModalOpen(false);
        setEditingLesson(null);
      };

      const handleEdit = (lesson) => {
        setEditingLesson(lesson);
        setFormData({
          date: lesson.date,
          teacher: lesson.teacher,
          audioFile: lesson.audioFile,
          audioFileName: lesson.audioFileName,
          summary: lesson.summary,
          noteImage: lesson.noteImage,
          noteImageName: lesson.noteImageName,
          diagramImage: lesson.diagramImage,
          diagramImageName: lesson.diagramImageName
        });
        setIsModalOpen(true);
      };

      const handleDelete = (id) => {
        if (window.confirm('„Åì„ÅÆ„É¨„ÉÉ„Çπ„É≥Ë®òÈå≤„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„Åã?')) {
          const updatedLessons = lessons.filter(l => l.id !== id);
          setLessons(updatedLessons);
          saveLessons(updatedLessons);
        }
      };

      const resetForm = () => {
        setFormData({
          date: '',
          teacher: '',
          audioFile: null,
          audioFileName: '',
          summary: '',
          noteImage: null,
          noteImageName: '',
          diagramImage: null,
          diagramImageName: ''
        });
      };

      const filteredLessons = lessons.filter(lesson => {
        const matchesSearch = lesson.summary.toLowerCase().includes(searchTerm.toLowerCase()) ||
          lesson.teacher.toLowerCase().includes(searchTerm.toLowerCase());
        const matchesTeacher = !filterTeacher || lesson.teacher === filterTeacher;
        return matchesSearch && matchesTeacher;
      });

      const uniqueTeachers = [...new Set(lessons.map(l => l.teacher))].filter(Boolean);

      return (
        <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 safe-bottom">
          <header className="bg-white shadow-md sticky top-0 z-10 safe-top">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <Music className="w-8 h-8 text-purple-600" />
                  <h1 className="text-2xl font-bold text-gray-900">„É¨„ÉÉ„Çπ„É≥Ë®òÈå≤</h1>
                </div>
                <button
                  onClick={() => {
                    resetForm();
                    setEditingLesson(null);
                    setIsModalOpen(true);
                  }}
                  className="flex items-center space-x-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors active:bg-purple-800"
                >
                  <Plus className="w-5 h-5" />
                  <span>Êñ∞Ë¶è</span>
                </button>
              </div>
            </div>
          </header>

          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div className="bg-white rounded-lg shadow-md p-4 mb-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="relative">
                  <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
                  <input
                    type="text"
                    placeholder="Ê§úÁ¥¢..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
                <select
                  value={filterTeacher}
                  onChange={(e) => setFilterTeacher(e.target.value)}
                  className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                  <option value="">„Åô„Åπ„Å¶„ÅÆÂÖàÁîü</option>
                  {uniqueTeachers.map(teacher => (
                    <option key={teacher} value={teacher}>{teacher}</option>
                  ))}
                </select>
              </div>
            </div>

            {isLoading ? (
              <div className="text-center py-12">
                <div className="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div>
                <p className="mt-4 text-gray-600">Ë™≠„ÅøËæº„Åø‰∏≠...</p>
              </div>
            ) : filteredLessons.length === 0 ? (
              <div className="text-center py-12 bg-white rounded-lg shadow-md">
                <Music className="w-16 h-16 text-gray-400 mx-auto mb-4" />
                <p className="text-gray-600 text-lg">
                  {lessons.length === 0 ? '„É¨„ÉÉ„Çπ„É≥Ë®òÈå≤„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì' : 'Ë©≤ÂΩì„Åô„ÇãË®òÈå≤„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì'}
                </p>
              </div>
            ) : (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {filteredLessons.map(lesson => (
                  <div key={lesson.id} className="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow overflow-hidden">
                    <div className="p-6">
                      <div className="flex justify-between items-start mb-4">
                        <div className="flex-1">
                          <div className="flex items-center text-gray-600 mb-2">
                            <Calendar className="w-4 h-4 mr-2" />
                            <span className="text-sm font-medium">{lesson.date}</span>
                          </div>
                          <div className="flex items-center text-purple-600 mb-3">
                            <User className="w-4 h-4 mr-2" />
                            <span className="font-semibold">{lesson.teacher}</span>
                          </div>
                        </div>
                        <div className="flex space-x-2">
                          <button
                            onClick={() => handleEdit(lesson)}
                            className="text-blue-600 hover:text-blue-800 p-1 active:bg-blue-50 rounded"
                          >
                            <Edit2 className="w-5 h-5" />
                          </button>
                          <button
                            onClick={() => handleDelete(lesson.id)}
                            className="text-red-600 hover:text-red-800 p-1 active:bg-red-50 rounded"
                          >
                            <Trash2 className="w-5 h-5" />
                          </button>
                        </div>
                      </div>

                      {lesson.summary && (
                        <div className="mb-4">
                          <div className="flex items-center text-gray-700 mb-2">
                            <FileText className="w-4 h-4 mr-2" />
                            <span className="text-sm font-medium">Ë¶ÅÁ¥Ñ</span>
                          </div>
                          <p className="text-gray-600 text-sm leading-relaxed">{lesson.summary}</p>
                        </div>
                      )}

                      {lesson.audioFile && (
                        <div className="mb-4">
                          <div className="flex items-center text-gray-700 mb-2">
                            <Mic className="w-4 h-4 mr-2" />
                            <span className="text-sm font-medium">Èü≥Â£∞</span>
                          </div>
                          <audio controls className="w-full" src={lesson.audioFile} />
                        </div>
                      )}

                      {lesson.noteImage && (
                        <div className="mb-4">
                          <div className="flex items-center text-gray-700 mb-2">
                            <Image className="w-4 h-4 mr-2" />
                            <span className="text-sm font-medium">„Éé„Éº„Éà</span>
                          </div>
                          <img src={lesson.noteImage} alt="„Éé„Éº„Éà" className="w-full rounded-lg border border-gray-200" />
                        </div>
                      )}

                      {lesson.diagramImage && (
                        <div>
                          <div className="flex items-center text-gray-700 mb-2">
                            <Image className="w-4 h-4 mr-2" />
                            <span className="text-sm font-medium">Âõ≥Ëß£</span>
                          </div>
                          <img src={lesson.diagramImage} alt="Âõ≥Ëß£" className="w-full rounded-lg border border-gray-200" />
                        </div>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {isModalOpen && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" style={{paddingTop: 'env(safe-area-inset-top)', paddingBottom: 'env(safe-area-inset-bottom)'}}>
              <div className="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto smooth-scroll">
                <div className="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center">
                  <h2 className="text-xl font-bold text-gray-900">
                    {editingLesson ? 'Á∑®ÈõÜ' : 'Êñ∞Ë¶èË®òÈå≤'}
                  </h2>
                  <button
                    onClick={() => {
                      setIsModalOpen(false);
                      setEditingLesson(null);
                      resetForm();
                    }}
                    className="text-gray-500 hover:text-gray-700 p-2 active:bg-gray-100 rounded"
                  >
                    <X className="w-6 h-6" />
                  </button>
                </div>

                <div className="p-6 space-y-6">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Êó•‰ªò <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="date"
                      value={formData.date}
                      onChange={(e) => setFormData({...formData, date: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ÂÖàÁîü <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      value={formData.teacher}
                      onChange={(e) => setFormData({...formData, teacher: e.target.value})}
                      placeholder="‰æã: Áî∞‰∏≠ÂÖàÁîü"
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Ë¶ÅÁ¥Ñ</label>
                    <textarea
                      value={formData.summary}
                      onChange={(e) => setFormData({...formData, summary: e.target.value})}
                      placeholder="„É¨„ÉÉ„Çπ„É≥ÂÜÖÂÆπ„ÇíË®òÈå≤..."
                      rows={4}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Èü≥Â£∞„Éï„Ç°„Ç§„É´</label>
                    <input
                      type="file"
                      accept="audio/mpeg,audio/mp3,audio/wav,audio/wave,audio/x-wav,audio/aac,audio/m4a,audio/ogg,audio/flac,audio/*"
                      onChange={(e) => handleFileChange(e, 'audioFile')}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                    <p className="mt-1 text-xs text-gray-500">MP3, WAV, M4A, AAC, OGG, FLACÂØæÂøú</p>
                    {formData.audioFileName && (
                      <p className="mt-2 text-sm text-green-600 font-medium">‚úì {formData.audioFileName}</p>
                    )}
                    {formData.audioFile && (
                      <div className="mt-3">
                        <p className="text-xs text-gray-600 mb-1">„Éó„É¨„Éì„É•„Éº:</p>
                        <audio controls className="w-full" src={formData.audioFile} />
                      </div>
                    )}
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">„Éé„Éº„ÉàÁîªÂÉè</label>
                    <input
                      type="file"
                      accept="image/jpeg,image/jpg,image/png,image/gif,image/webp,image/heic,image/heif,image/*"
                      onChange={(e) => handleFileChange(e, 'noteImage')}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                    <p className="mt-1 text-xs text-gray-500">JPG, PNG, GIF, WebP, HEICÂØæÂøú</p>
                    {formData.noteImageName && (
                      <p className="mt-2 text-sm text-green-600 font-medium">‚úì {formData.noteImageName}</p>
                    )}
                    {formData.noteImage && (
                      <div className="mt-3">
                        <p className="text-xs text-gray-600 mb-1">„Éó„É¨„Éì„É•„Éº:</p>
                        <img src={formData.noteImage} alt="„Éó„É¨„Éì„É•„Éº" className="w-full max-w-xs rounded-lg border border-gray-200" />
                      </div>
                    )}
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Âõ≥Ëß£ÁîªÂÉè</label>
                    <input
                      type="file"
                      accept="image/jpeg,image/jpg,image/png,image/gif,image/webp,image/heic,image/heif,image/*"
                      onChange={(e) => handleFileChange(e, 'diagramImage')}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                    <p className="mt-1 text-xs text-gray-500">JPG, PNG, GIF, WebP, HEICÂØæÂøú</p>
                    {formData.diagramImageName && (
                      <p className="mt-2 text-sm text-green-600 font-medium">‚úì {formData.diagramImageName}</p>
                    )}
                    {formData.diagramImage && (
                      <div className="mt-3">
                        <p className="text-xs text-gray-600 mb-1">„Éó„É¨„Éì„É•„Éº:</p>
                        <img src={formData.diagramImage} alt="„Éó„É¨„Éì„É•„Éº" className="w-full max-w-xs rounded-lg border border-gray-200" />
                      </div>
                    )}
                  </div>

                  <div className="flex space-x-4 pt-4 border-t border-gray-200">
                    <button
                      onClick={handleSubmit}
                      className="flex-1 flex items-center justify-center space-x-2 bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 active:bg-purple-800 transition-colors font-medium"
                    >
                      <Save className="w-5 h-5" />
                      <span>{editingLesson ? 'Êõ¥Êñ∞' : '‰øùÂ≠ò'}</span>
                    </button>
                    <button
                      onClick={() => {
                        setIsModalOpen(false);
                        setEditingLesson(null);
                        resetForm();
                      }}
                      className="flex-1 bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 active:bg-gray-400 transition-colors font-medium"
                    >
                      „Ç≠„É£„É≥„Çª„É´
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<MusicLessonTracker />, document.getElementById('root'));
  </script>

</body>
</html>
